<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600 1000">
  <!-- Title -->
  <text x="800" y="40" font-size="28" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    CI/CD Pipeline Flow (GitHub Actions)
  </text>

  <!-- Developer -->
  <g id="developer">
    <circle cx="100" cy="120" r="50" fill="#4caf50" stroke="#2e7d32" stroke-width="3"/>
    <text x="100" y="130" font-size="24" text-anchor="middle" fill="#fff">üë®‚Äçüíª</text>
    <text x="100" y="190" font-size="14" font-weight="bold" text-anchor="middle" fill="#2e7d32">
      Developer
    </text>
    <text x="100" y="210" font-size="12" text-anchor="middle" fill="#666">
      Code Changes
    </text>
  </g>

  <!-- Git Push -->
  <g id="git-push">
    <path d="M 150 120 L 230 120" stroke="#4caf50" stroke-width="4" fill="none" marker-end="url(#arrowgreen)"/>
    <rect x="165" y="90" width="50" height="25" fill="#fff" stroke="#4caf50" stroke-width="1" rx="3"/>
    <text x="190" y="107" font-size="11" text-anchor="middle" fill="#2e7d32" font-weight="bold">
      git push
    </text>
  </g>

  <!-- GitHub Repository -->
  <g id="github-repo">
    <rect x="250" y="60" width="200" height="120" fill="#24292e" stroke="#333" stroke-width="3" rx="10"/>
    <text x="350" y="90" font-size="16" font-weight="bold" text-anchor="middle" fill="#fff">
      GitHub
    </text>
    <text x="350" y="115" font-size="13" text-anchor="middle" fill="#fff">
      Main Branch
    </text>
    <rect x="270" y="130" width="160" height="35" fill="#0366d6" stroke="#044289" stroke-width="2" rx="5"/>
    <text x="350" y="152" font-size="12" text-anchor="middle" fill="#fff">
      Trigger: push event
    </text>
  </g>

  <!-- Trigger to GitHub Actions -->
  <path d="M 350 180 L 350 240" stroke="#0366d6" stroke-width="4" fill="none" marker-end="url(#arrowblue)"/>
  <text x="370" y="215" font-size="11" fill="#0366d6" font-weight="bold">webhook</text>

  <!-- GitHub Actions -->
  <g id="github-actions">
    <rect x="50" y="260" width="1500" height="680" fill="#f6f8fa" stroke="#0366d6" stroke-width="4" rx="15"/>
    <text x="800" y="295" font-size="20" font-weight="bold" text-anchor="middle" fill="#0366d6">
      GitHub Actions Workflow (.github/workflows/deploy.yml)
    </text>

    <!-- Stage 1: Build & Test -->
    <g id="stage1">
      <rect x="100" y="330" width="300" height="280" fill="#fff" stroke="#4caf50" stroke-width="3" rx="10"/>
      <rect x="100" y="330" width="300" height="40" fill="#4caf50" stroke="#2e7d32" stroke-width="2" rx="10"/>
      <text x="250" y="357" font-size="16" font-weight="bold" text-anchor="middle" fill="#fff">
        Stage 1: Build &amp; Test
      </text>

      <g id="stage1-steps">
        <!-- Step 1.1 -->
        <rect x="120" y="390" width="260" height="50" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5"/>
        <text x="130" y="410" font-size="12" font-weight="bold" fill="#2e7d32">1.1 Checkout Code</text>
        <text x="130" y="428" font-size="10" fill="#555">actions/checkout@v3</text>

        <!-- Step 1.2 -->
        <rect x="120" y="455" width="260" height="50" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5"/>
        <text x="130" y="475" font-size="12" font-weight="bold" fill="#2e7d32">1.2 Setup Java 17</text>
        <text x="130" y="493" font-size="10" fill="#555">actions/setup-java@v3</text>

        <!-- Step 1.3 -->
        <rect x="120" y="520" width="260" height="50" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5"/>
        <text x="130" y="540" font-size="12" font-weight="bold" fill="#2e7d32">1.3 Gradle Build &amp; Test</text>
        <text x="130" y="558" font-size="10" fill="#555">./gradlew clean build test</text>
      </g>

      <text x="250" y="595" font-size="11" text-anchor="middle" fill="#666">
        ‚úì JUnit Tests, Integration Tests
      </text>
    </g>

    <!-- Stage 2: Docker Build -->
    <g id="stage2">
      <rect x="450" y="330" width="300" height="280" fill="#fff" stroke="#1976d2" stroke-width="3" rx="10"/>
      <rect x="450" y="330" width="300" height="40" fill="#1976d2" stroke="#0d47a1" stroke-width="2" rx="10"/>
      <text x="600" y="357" font-size="16" font-weight="bold" text-anchor="middle" fill="#fff">
        Stage 2: Docker Build
      </text>

      <g id="stage2-steps">
        <!-- Step 2.1 -->
        <rect x="470" y="390" width="260" height="50" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
        <text x="480" y="410" font-size="12" font-weight="bold" fill="#0d47a1">2.1 Set up Docker Buildx</text>
        <text x="480" y="428" font-size="10" fill="#555">docker/setup-buildx-action@v2</text>

        <!-- Step 2.2 -->
        <rect x="470" y="455" width="260" height="50" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
        <text x="480" y="475" font-size="12" font-weight="bold" fill="#0d47a1">2.2 Login to Docker Hub</text>
        <text x="480" y="493" font-size="10" fill="#555">docker/login-action@v2</text>

        <!-- Step 2.3 -->
        <rect x="470" y="520" width="260" height="50" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
        <text x="480" y="540" font-size="12" font-weight="bold" fill="#0d47a1">2.3 Build &amp; Push Image</text>
        <text x="480" y="558" font-size="10" fill="#555">docker build -t user/library-app</text>
      </g>

      <text x="600" y="595" font-size="11" text-anchor="middle" fill="#666">
        ‚úì Multi-stage build, Tags: latest, git-sha
      </text>
    </g>

    <!-- Stage 3: Push to Docker Hub -->
    <g id="stage3">
      <rect x="800" y="330" width="300" height="280" fill="#fff" stroke="#00bcd4" stroke-width="3" rx="10"/>
      <rect x="800" y="330" width="300" height="40" fill="#00bcd4" stroke="#006064" stroke-width="2" rx="10"/>
      <text x="950" y="357" font-size="16" font-weight="bold" text-anchor="middle" fill="#fff">
        Stage 3: Push Registry
      </text>

      <g id="stage3-visual">
        <rect x="830" y="400" width="240" height="180" fill="#e0f7fa" stroke="#00bcd4" stroke-width="2" rx="5"/>

        <text x="950" y="430" font-size="14" font-weight="bold" text-anchor="middle" fill="#006064">
          Docker Hub
        </text>

        <rect x="850" y="450" width="200" height="35" fill="#00bcd4" stroke="#006064" stroke-width="1" rx="3"/>
        <text x="950" y="473" font-size="11" text-anchor="middle" fill="#fff">
          user/library-app:latest
        </text>

        <rect x="850" y="495" width="200" height="35" fill="#00bcd4" stroke="#006064" stroke-width="1" rx="3"/>
        <text x="950" y="518" font-size="11" text-anchor="middle" fill="#fff">
          user/library-app:abc1234
        </text>

        <text x="950" y="555" font-size="10" text-anchor="middle" fill="#666">
          (git SHA tag)
        </text>
      </g>
    </g>

    <!-- Stage 4: Deploy to EC2 -->
    <g id="stage4">
      <rect x="1150" y="330" width="350" height="280" fill="#fff" stroke="#ff6f00" stroke-width="3" rx="10"/>
      <rect x="1150" y="330" width="350" height="40" fill="#ff6f00" stroke="#e65100" stroke-width="2" rx="10"/>
      <text x="1325" y="357" font-size="16" font-weight="bold" text-anchor="middle" fill="#fff">
        Stage 4: Deploy to EC2
      </text>

      <g id="stage4-steps">
        <!-- Step 4.1 -->
        <rect x="1170" y="390" width="310" height="45" fill="#fff3e0" stroke="#ff6f00" stroke-width="2" rx="5"/>
        <text x="1180" y="410" font-size="12" font-weight="bold" fill="#e65100">4.1 SSH to EC2</text>
        <text x="1180" y="425" font-size="10" fill="#555">appleboy/ssh-action@master</text>

        <!-- Step 4.2 -->
        <rect x="1170" y="445" width="310" height="45" fill="#fff3e0" stroke="#ff6f00" stroke-width="2" rx="5"/>
        <text x="1180" y="465" font-size="12" font-weight="bold" fill="#e65100">4.2 Pull Latest Image</text>
        <text x="1180" y="480" font-size="10" fill="#555">docker pull user/library-app:latest</text>

        <!-- Step 4.3 -->
        <rect x="1170" y="500" width="310" height="45" fill="#fff3e0" stroke="#ff6f00" stroke-width="2" rx="5"/>
        <text x="1180" y="520" font-size="12" font-weight="bold" fill="#e65100">4.3 Stop Old Container</text>
        <text x="1180" y="535" font-size="10" fill="#555">docker compose down</text>

        <!-- Step 4.4 -->
        <rect x="1170" y="555" width="310" height="45" fill="#fff3e0" stroke="#ff6f00" stroke-width="2" rx="5"/>
        <text x="1180" y="575" font-size="12" font-weight="bold" fill="#e65100">4.4 Start New Container</text>
        <text x="1180" y="590" font-size="10" fill="#555">docker compose up -d</text>
      </g>
    </g>

    <!-- Stage 5: Health Check -->
    <g id="stage5">
      <rect x="100" y="640" width="1400" height="130" fill="#fff" stroke="#9c27b0" stroke-width="3" rx="10"/>
      <rect x="100" y="640" width="1400" height="40" fill="#9c27b0" stroke="#6a1b9a" stroke-width="2" rx="10"/>
      <text x="800" y="667" font-size="16" font-weight="bold" text-anchor="middle" fill="#fff">
        Stage 5: Health Check &amp; Verification
      </text>

      <g id="stage5-steps">
        <!-- Health check loop -->
        <rect x="130" y="700" width="400" height="55" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" rx="5"/>
        <text x="140" y="720" font-size="12" font-weight="bold" fill="#6a1b9a">
          5.1 Wait for Application Start (40s)
        </text>
        <text x="140" y="740" font-size="10" fill="#555">
          Loop: Check /actuator/health (15 attempts, 10s interval)
        </text>

        <!-- Success -->
        <rect x="580" y="700" width="250" height="55" fill="#c8e6c9" stroke="#4caf50" stroke-width="2" rx="5"/>
        <text x="705" y="720" font-size="12" font-weight="bold" text-anchor="middle" fill="#2e7d32">
          ‚úì Success
        </text>
        <text x="705" y="740" font-size="10" text-anchor="middle" fill="#555">
          status: UP ‚Üí Deployment Complete
        </text>

        <!-- Failure -->
        <rect x="880" y="700" width="250" height="55" fill="#ffcdd2" stroke="#f44336" stroke-width="2" rx="5"/>
        <text x="1005" y="720" font-size="12" font-weight="bold" text-anchor="middle" fill="#c62828">
          ‚úó Failure
        </text>
        <text x="1005" y="740" font-size="10" text-anchor="middle" fill="#555">
          Rollback to previous version
        </text>

        <!-- Notification -->
        <rect x="1180" y="700" width="290" height="55" fill="#fff9c4" stroke="#fbc02d" stroke-width="2" rx="5"/>
        <text x="1325" y="720" font-size="12" font-weight="bold" text-anchor="middle" fill="#f57f17">
          5.2 Send Notification
        </text>
        <text x="1325" y="740" font-size="10" text-anchor="middle" fill="#555">
          Email/Slack: Deployment Status
        </text>
      </g>
    </g>

    <!-- Flow arrows between stages -->
    <path d="M 400 470 L 450 470" stroke="#4caf50" stroke-width="4" fill="none" marker-end="url(#arrowgreen2)"/>
    <path d="M 750 470 L 800 470" stroke="#1976d2" stroke-width="4" fill="none" marker-end="url(#arrowblue2)"/>
    <path d="M 1100 470 L 1150 470" stroke="#00bcd4" stroke-width="4" fill="none" marker-end="url(#arrowcyan)"/>
    <path d="M 1325 610 L 1325 640" stroke="#ff6f00" stroke-width="4" fill="none" marker-end="url(#arroworange2)"/>

    <!-- Time indicators -->
    <text x="250" y="800" font-size="11" text-anchor="middle" fill="#666">~2-3 min</text>
    <text x="600" y="800" font-size="11" text-anchor="middle" fill="#666">~1-2 min</text>
    <text x="950" y="800" font-size="11" text-anchor="middle" fill="#666">~30 sec</text>
    <text x="1325" y="800" font-size="11" text-anchor="middle" fill="#666">~1-2 min</text>
    <text x="800" y="820" font-size="11" text-anchor="middle" fill="#666">~1 min</text>
  </g>

  <!-- EC2 Deployed -->
  <g id="ec2-deployed">
    <rect x="1325" y="870" width="200" height="80" fill="#fff3e0" stroke="#ff6f00" stroke-width="3" rx="10"/>
    <text x="1425" y="895" font-size="14" font-weight="bold" text-anchor="middle" fill="#e65100">
      EC2 Instance
    </text>
    <text x="1425" y="915" font-size="12" text-anchor="middle" fill="#666">
      Application Running
    </text>
    <text x="1425" y="935" font-size="11" text-anchor="middle" fill="#4caf50" font-weight="bold">
      ‚úì HEALTHY
    </text>
  </g>

  <!-- Connection to EC2 -->
  <path d="M 1425 850 L 1425 870" stroke="#ff6f00" stroke-width="4" fill="none" marker-end="url(#arroworange2)"/>

  <!-- Summary -->
  <g id="summary">
    <rect x="50" y="960" width="1500" height="30" fill="#eceff1" stroke="#607d8b" stroke-width="2" rx="5"/>
    <text x="60" y="980" font-size="12" fill="#263238" font-weight="bold">
      Total Pipeline Duration: ~6-9 minutes | Triggered automatically on git push to main branch
    </text>
  </g>

  <!-- Arrow markers -->
  <defs>
    <marker id="arrowgreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#4caf50"/>
    </marker>
    <marker id="arrowblue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#0366d6"/>
    </marker>
    <marker id="arrowgreen2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#4caf50"/>
    </marker>
    <marker id="arrowblue2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#1976d2"/>
    </marker>
    <marker id="arrowcyan" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#00bcd4"/>
    </marker>
    <marker id="arroworange2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#ff6f00"/>
    </marker>
  </defs>
</svg>
